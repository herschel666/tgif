<!DOCTYPE html>
<html lang="en" class="text-gray-900 antialiased">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/1.1.2/tailwind.min.css"
      integrity="sha256-bCQF5OufWlWM/MW9mCb/eDibvff1W8BNq9ZK69C8FSI="
      crossorigin="anonymous"
    />
    <meta name="robots" content="noindex,nofollow,noarchive" />
    <title>Settings | tgif Telegram bot</title>
  </head>
  <body class="bg-white">
    <main class="container mx-auto p-4 my-2">
      <h1
        class="mb-8 pb-2 border-b-2 border-gray-200 text-xl text-gray-900 leading-tight"
      >
        tgif Settings
      </h1>
      <form action="" method="post" class="mb-4">
        <fieldset>
          <legend class="text-base leading-normal">
            Edit your settings…
          </legend>
          <div class="p-4 my-4 bg-gray-100">
            <label class="block text-base leading-normal" for="timezone_offset">
              Your timezone
            </label>
            <select
              name="timezone_offset"
              id="timezone_offset"
              class="mt-2 shadow opacity-50"
              disabled
            >
              <option value="">Loading timezones…</option>
            </select>
          </div>
          <button
            class="bg-blue-500 hover:bg-blue-700 focus:bg-blue-700 text-white font-bold py-2 px-4"
          >
            Submit
          </button>
        </fieldset>
      </form>
    </main>
    <footer class="container mx-auto p-4 my-2 text-gray-600">
      <p>
        &copy;
        <a
          href="https://twitter.com/Herschel_R"
          target="_blank"
          rel="noopener noreferrer"
          class="hover:text-blue-600 focus:text-blue-600 hover:underline focus:underline"
        >
          Emanuel Kluge
        </a>
        {{year}}
      </p>
    </footer>

    <script>
      const select = document.getElementById('timezone_offset');

      const sortData = (data) => {
        const list = data
          .reduce(
            (acc, value) =>
              acc.concat(
                value.utc
                  .filter((name) => !name.startsWith('Etc/'))
                  .filter((name) => name.includes('/'))
                  .map((name) => ({ offset: value.offset, name }))
              ),
            []
          )
          .reduce((acc, item, i, arr) => {
            const index = arr.findIndex(({ name }) => item.name === name);
            if (index < i) {
              return acc;
            }
            return acc.concat(item);
          }, [])
          .sort((a, b) => a.name.localeCompare(b.name));
        const europe = list.filter(({ name }) => name.startsWith('Europe/'));
        const otherWorld = list.filter(
          ({ name }) => !name.startsWith('Europe/')
        );

        return europe.concat(otherWorld);
      };

      const init = (timezones) => {
        const frag = document.createDocumentFragment();

        timezones.forEach(({ name: textContent }) =>
          frag.appendChild(
            Object.assign(document.createElement('option'), {
              textContent,
            })
          )
        );

        select.removeAttribute('disabled');
        select.classList.remove('opacity-50');
        select.firstElementChild.textContent = 'Select your timezone…';
        select.appendChild(frag);
      };

      const handleError = (err) => {
        console.error(err);

        select.parentNode.appendChild(
          Object.assign(document.createElement('p'), {
            textContent:
              'Failed to load the timezones. Try reloading the page.',
            className: 'mt-2 text-sm text-red-700',
          })
        );
      };

      fetch('https://unpkg.com/timezones.json@1.5.0/timezones.json').then(
        (response) =>
          response
            .json()
            .then(sortData)
            .then(init),
        handleError
      );
    </script>
  </body>
</html>
